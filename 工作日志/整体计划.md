# MyAgent 渐进式开发路线图

## 目标

搭建一个**个人知识库问答智能体**，具备 RAG（检索增强生成）、工具调用、对话记忆三大核心能力。

## 策略

先用 LangChain/LangGraph 的高层封装快速跑通，再逐步深入底层实现。每个阶段都产出一个**可运行的版本**。

## 技术栈

- LLM: ChatTongyi (DeepSeek V3.1 via DashScope)
- 框架: LangChain + LangGraph
- 语言: Python

## 节奏

每天 3-4 小时，每个 Phase 预计 1-3 天。

---

## 路线总览

```
Phase 1 (Day 1)      基础 Agent        ← 用预构建函数跑通工具调用         ✅ 已完成
Phase 2 (Day 2-3)    加入 RAG          ← 能基于本地文档回答问题           ✅ 已完成
Phase 3 (Day 4-5)    加入 Memory       ← 对话记忆持久化，跨会话记住上下文
Phase 4 (Day 6-8)    深入 Agent 图     ← 替换预构建为手动 LangGraph，自定义 ReAct 循环
Phase 5 (Day 9-11)   深入 RAG 管线     ← 自定义分块、嵌入、检索策略，提升问答质量
Phase 6 (Day 12+)    高级特性          ← 流式输出、Web UI、多轮 RAG、自适应检索
```

---

## Phase 1 — 基础 Agent ✅

**目标**: 用 `create_react_agent` 预构建函数，最快速度跑出一个能调工具的 Agent。

**产出**: CLI 交互式 Agent，能调用 3 个工具回答问题。

**内容**:
- 项目基础设施: `.gitignore`、`.env`、`requirements.txt`
- agent 包: `config.py`（环境变量）、`llm.py`（LLM 封装）、`tools.py`（3 个工具）
- 3 个工具: 日期时间、安全计算器、DuckDuckGo 搜索
- CLI 入口: `main.py`，使用 `create_react_agent` + 交互式聊天循环

---

## Phase 2 — 加入 RAG ✅

**目标**: 能加载本地文档（PDF/Markdown/TXT），基于文档内容回答问题。

**方式**: 用 LangChain 高层封装（`RecursiveCharacterTextSplitter` + `FAISS` + Retriever 作为 Agent 工具）。

**内容**:
- 新增依赖: `faiss-cpu`、`langchain-text-splitters`、DashScope embedding (`text-embedding-v3`)
- 创建 `agent/rag/` 子包:
  - `loader.py` — 文档加载（PDF/MD/TXT）
  - `vectorstore.py` — 文本分块 + FAISS 向量化 + 持久化
  - `retriever.py` — 包装为 LangChain Retriever
- 将 Retriever 包装为 Agent 工具，Agent 自己判断何时查文档
- 创建 `data/` 目录放测试文档
- 创建 `scripts/index_docs.py` 一键索引文档

**验证**:
```
python scripts/index_docs.py data/
python main.py
> 根据我的文档，xxx是什么？    → 调用 RAG 工具检索后回答
```

---

## Phase 3 — 加入 Memory

**目标**: 对话记忆持久化，关闭程序后重开仍然记住之前的对话。

**方式**: LangGraph 的 `MemorySaver`（内存）→ `SqliteSaver`（持久化 SQLite）。

**内容**:
- `agent/memory/checkpointer.py` — SqliteSaver 配置
- `thread_id` 管理 — 支持切换/恢复历史对话
- 对话列表功能

**验证**:
```
python main.py
> 我叫小明           → Agent 记住
> [退出重启]
> 我叫什么？         → 回答"小明"
```

---

## Phase 4 — 深入 Agent 图

**目标**: 将 `create_react_agent` 替换为手动构建的 LangGraph 状态图，完全理解和掌控 ReAct 循环。

**意义**: 从"会用"到"会改"的关键一步。

**内容**:
- 手动定义 `AgentState`、`agent_node`、`tool_node`、`should_continue` 条件路由
- 加入自定义节点: `preprocess_node`（查询改写）、`postprocess_node`（结果格式化）
- 可视化 Agent 图

---

## Phase 5 — 深入 RAG 管线

**目标**: 替换 Phase 2 的高层封装，自定义每个 RAG 环节，提升问答质量。

**内容**:
- 自定义分块策略（语义分块，按标题/段落）
- 优化检索（hybrid search: BM25 + 向量、reranker、MMR 去重）
- 查询改写（LLM 改写用户问题提高命中率）
- 来源追踪（回答附带文档名 + 页码引用）

---

## Phase 6 — 高级特性（按需选做）

| 特性 | 说明 | 预计耗时 |
|------|------|----------|
| 流式输出 | `graph.astream()` 逐 token 输出 | 0.5 天 |
| Web UI | FastAPI + 前端 或 Gradio | 1-2 天 |
| 多格式文档 | 支持 Word、Excel、网页 URL | 1 天 |
| 自适应检索 | Agent 自动决定是否需要 RAG | 0.5 天 |
| 长期记忆 | 跨对话的用户偏好/关键信息存储 | 1-2 天 |
| MCP 集成 | Model Context Protocol 标准化工具接口 | 1 天 |
